<%
const protocol = 'http';
const upstream = protocol + '-' + vhost;
const port_label = 'com.latanowicz.proxy.virtual_' + protocol + '_port';
const vhost_label = 'com.latanowicz.proxy.virtual_host';
const filteredContainers = containers
        .filter((container) => container.labels[vhost_label] && container.labels[vhost_label].split(',').indexOf(vhost) >= 0)
        .filter((container) => !!container.labels[port_label]);

if (filteredContainers.length > 0) { %>

<%- include('upstream.ejs', {containers: filteredContainers, vhost: vhost, label: port_label, upstream: upstream, current: current}); %>

server {
    server_name <%= vhost %>;
    listen 80;
    access_log /var/log/nginx/access-http.log vhost;

    location / {
        proxy_pass http://<%= upstream %>;
        proxy_connect_timeout 300;
        proxy_send_timeout 300;
        proxy_read_timeout 600;
    }
}

<% } else { %>

# no containers for HTTP at vhost <%= vhost %>

<% } %>
